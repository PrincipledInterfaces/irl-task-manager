<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    ServerName internal.irl.depaul.edu
    ServerAlias www.internal.irl.depaul.edu

 # -- internal.irl cotent: frontend --
    DocumentRoot /var/www/internal.irl.depaul.edu/IRL-todo/frontend/dist

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

# -- Proxy IRL Todo App backend --
   ProxyPass /todo-backend/ http://localhost:5000/ retry=0
   ProxyPassReverse /todo-backend/ http://localhost:5000/

# -- Proxy for the checkin backend API --
    ProxyPass /api http://localhost:5001/api retry=0
    ProxyPassReverse /api http://localhost:5001/api

    # -- /checkin/ frontend --
    Alias /checkin /var/www/internal.irl.depaul.edu/irl-authorizationtracker/frontend/build
    <Directory /var/www/internal.irl.depaul.edu/irl-authorizationtracker/frontend/build>
      Options -Indexes +FollowSymLinks
      AllowOverride All
      Require all granted
      FallbackResource /checkin/index.html
    </Directory>

 # -- airquality frontend --
Alias /airquality /var/www/air-quality.internal.irl.depaul.edu/AirQualityData/frontend/dist
<Directory /var/www/air-quality.internal.irl.depaul.edu/AirQualityData/frontend/dist/>
  Options FollowSymLinks
  AllowOverride None
 Require all granted
 DirectoryIndex index.html
</Directory>

# Reverse proxy for task manager API (must come before Alias)
ProxyPass /tasks/api http://localhost:3000/api retry=0
ProxyPassReverse /tasks/api http://localhost:3000/api

# Serve task manager from /irl-task-manager
Alias /tasks /var/www/internal.irl.depaul.edu/irl-task-manager
      <Directory /var/www/internal.irl.depaul.edu/irl-task-manager>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
      </Directory>

 # airquality backend
WSGIDaemonProcess airquality \
python-home=/var/www/air-quality.internal.irl.depaul.edu/AirQualityData/backend/venv \
python-path=/var/www/air-quality.internal.irl.depaul.edu/AirQualityData/backend
WSGIProcessGroup airquality
# mmounting flask app to listion to /airquality-backend
WSGIScriptAlias /airquality-backend /var/www/air-quality.internal.irl.depaul.edu/AirQualityData/backend/airQuality.wsgi

<Directory /var/www/air-quality.internal.irl.depaul.edu/AirQualityData/backend>
  Require all granted
   <Files airQuality.wsgi>
      Require all granted
  </Files>
</Directory>


#-- SSL certificate --
  SSLEngine on
 Include /etc/letsencrypt/options-ssl-apache.conf
 SSLCertificateFile /etc/letsencrypt/live/internal.irl.depaul.edu/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/internal.irl.depaul.edu/privkey.pem
</VirtualHost>
</IfModule>
<Directory /var/www/internal.irl.depaul.edu/irl-task-manager>
    Options -Indexes +FollowSymLinks +MultiViews
    AllowOverride All
    Require all granted
</Directory>
